@model PlataformaIEB.ViewModel.VMEntao
@{
    ViewBag.Title = "Entao";
    Layout = "~/Areas/RestritoPesquisador/Views/Shared/_Layout.cshtml";
}

<div class="row">
    <div class="row" style="text-align:center; border:ridge">
        <table class="table table-responsive">
            <caption><h2>@Model.Regra.Nome</h2></caption>
            <tbody>
                <tr><td><h5>SE</h5></td></tr>
                <tr>
                    <td>@Model.Regra.Se.Variavel.Nome</td>
                    @if (@Model.Regra.Se.NOT)
                    {
                        <td>NÃO FOR</td>
                    }
                    <td>@Model.Regra.Se.Operador</td>
                    <td>@Model.Regra.Se.Valor</td>
                </tr>
                @for (int i = 1; i <= Model.Pos; i++)
                {
                    if (Model.Regra.E.Select(o => o.Pos).Contains(i))
                    {
                        var E = Model.Regra.E.Where(a => a.Pos == i).SingleOrDefault();
                        <tr><td><h5>E</h5></td></tr>
                        <tr>
                            <td>@E.Cabeca.Variavel.Nome</td>
                            @if (@E.Cabeca.NOT)
                            {
                                <td>NÃO FOR</td>
                            }
                            <td>@E.Cabeca.Operador</td>
                            <td>@E.Cabeca.Valor</td>

                        </tr>
                    }
                    if (Model.Regra.Ou.Select(o => o.Pos).Contains(i))
                    {
                        var OU = Model.Regra.Ou.Where(a => a.Pos == i).SingleOrDefault();
                        <tr><td><h5>OU</h5></td></tr>
                        <tr>
                            <td>@OU.Cabeca.Variavel.Nome</td>
                            @if (OU.Cabeca.NOT)
                            {
                                <td>NÃO FOR</td>
                            }
                            <td>@OU.Cabeca.Operador</td>
                            <td>@OU.Cabeca.Valor</td>
                        </tr>
                    }
                }
                <tr><td><h5>ENTÃO</h5></td></tr>
                @foreach (var item in Model.Regra.Entao)
                {
                    <tr>
                        <td>@item.Acao.Variavel.Nome</td>
                        <td>é igual</td>
                        <td>@item.Acao.Valor</td>
                        <td>confiança = @(item.Acao.Confianca*100) "%"</td>
                    </tr>
                }

            </tbody>
        </table>
    </div>
    <div class="row" style="text-align:center">
        @using (Html.BeginForm())
        {
            @Html.AntiForgeryToken()
            @Html.HiddenFor(o => o.RegraID)

            <h2>Nova Condição</h2>
            <p>Para adicionar uma nova regra, entre com um novo nome e uma condição. Após, selecione as opções nos botões Adicionar Condição ou Adicionar Ação</p>
            <div class="row">
                <div class="form-group">
                    <table class="table table-responsive" style="align-items:center">
                        <thead>
                            <tr></tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>@Html.DisplayNameFor(m => m.Var)</td>
                                <td>@Html.DropDownListFor(m => m.Var, new SelectList(Model.Variaveis), "Selecione uma Variavel...", new { @class = "form-control" })</td>
                                <td>@Html.DisplayNameFor(m => m.Valor)</td>
                                <td>@Html.EditorFor(m => m.Valor, new { @class = "form-control" })</td>
                                <td>@Html.DisplayNameFor(m => m.Conf)</td>
                                <td>@Html.EditorFor(m => m.Conf, new { @class = "form-control" })</td>
                            </tr>
                        </tbody>
                    </table>
                    <span class="help-block">
                        @Html.ValidationMessageFor(m => m.Var)
                    </span>
                </div>
            </div>
            <div class="row" style="text-align:right">
                <input type="submit" class="btn btn-default" value="Adicionar" />
                @Html.ActionLink("Nova Regra", "Regra/"+ @Model.Regra.Base.ID, "Especialista", new { @class = "btn btn-danger" })
            </div>
        }
    </div>
</div>

